@model KarpicentroWeb.Models.ProductViewModel

@{
    if (ViewBag.Nivel == "Admin")
    {
        Layout = "_LayoutAdmin";
    }
    else if (ViewBag.Nivel == "Cliente")
    {
        Layout = "_LayoutUsers";
    }
}

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="~/css/Detalles.css">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Big+Shoulders+Display:wght@501&family=Big+Shoulders+Text:wght@383&family=Lobster&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&family=Overlock+SC&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Ropa+Sans:ital@0;1&display=swap" rel="stylesheet">

    <title>Detalles</title>
</head>

<style>
    * {
        box-sizing: border-box;
    }

    html {
        scroll-behavior: smooth;
    }
</style>

<body>
    <form method="post">
        <section class="py-5">
            <div class="container">
                <div class="row gx-5">
                    <aside class="col-lg-6">
                        <div class="border rounded-4 mb-3 d-flex justify-content-center">
                            @{
                                foreach (var i in Model.Inter)
                                {
                                    if (ViewBag.IDproducto == i.idProducts)
                                    {
                                        <a class="rounded-4" target="_blank" data-type="image" href="https://http2.mlstatic.com/D_NQ_NP_611357-MLU71495380687_092023-O.webp">
                                            <img id="main-image" style="max-width: 600px; max-height: 600px; margin: auto;" class="rounded-4 fit" src="@i.Image" />
                                        </a>
                                        break;
                                    }
                                }
                            }
                        </div>
                    </aside>
                    <article class="col-lg-6">
                        <h6 class="text-uppercase">Detalles</h6>
                        @{
                            foreach (var i in Model.Products)
                            {
                                if (ViewBag.IDproducto == i.ID)
                                {
                                    <h1 class="h2">@i.Name</h1>
                                    break;
                                }
                            }
                        }
                        @{
                            foreach (var i in Model.Inter)
                            {
                                if (ViewBag.IDproducto == i.idProducts)
                                {
                                    <div class="d-flex mb-4">
                                        <p class="h5 me-4 mb-0">$@i.SalePrice</p>
                                        <p class="h5 me-4 mb-0">Cantidad: @i.Stock</p>
                                    </div>
                                    break;
                                }
                            }
                        }
                        @{
                            foreach (var i in Model.Products)
                                if (ViewBag.IDproducto == i.ID)
                                {
                                    <p class="text-muted">
                                        @i.Description
                                    </p>
                                    break;
                                }
                        }
                        <hr />
                        <div class="d-flex mb-3">
                            <div class="me-3">
                                <p class="mb-0"><strong>Dimensiones :</strong></p>
                                <ul class="list-unstyled">
                                    @{
                                        foreach (var i in Model.Products)
                                            if (ViewBag.IDproducto == i.ID)
                                            {
                                                <li><i class="fas text-primary me-1"></i> Alto - @i.Height cm</li>
                                                <li><i class="fas text-primary me-1"></i> Ancho - @i.Width cm</li>
                                                <li><i class="fas text-primary me-1"></i> Profundo - @i.Depth cm</li>
                                                break;
                                            }
                                    }
                                </ul>
                            </div>
                            <div class="me-5">
                                <label class="form-label" for="select-color">Color:</label>
                                <select class="form-select" id="select-color" onchange="cambiarImagenes()">
                                    <option value="1">azul</option>
                                    <option value="2">verde</option>
                                    <option value="3">rosa</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label" for="input-quantity">Cantidad:</label>
                                <input class="form-control" id="amountInput" name="Amount" type="number" value="1" max="@Model.Inter.FirstOrDefault()?.Stock">
                            </div>
                        </div>
                        <br />
                        @{
                            if (ViewBag.Existencia > 0)
                            {
                                foreach (var i in Model.Inter)
                                {
                                    if (ViewBag.IDproducto == i.idProducts)
                                    {
                                        <input name="Existencia" type="hidden" value="@i.Stock">
                                        <input name="Price" type="hidden" value="@Model.Inter.FirstOrDefault(i => i.idProducts == ViewBag.IDproducto)?.SalePrice" />
                                        break;
                                    }
                                }
                                <div class="d-flex justify-content-center mt-3">
                                    <input name="idprod" type="hidden" value="@ViewBag.IDproducto">
                                    <input name="idProductInter" type="hidden" value="@Model.Inter.FirstOrDefault(c => c.idProducts == ViewBag.IDproducto)?.ID">
                                    <!-- Reducir el margen superior -->
                                    <button class="btn btn-primary text-white" asp-controller="Productos" asp-action="ProductDetails">Confirmar</button>
                                </div>
                                <div class="d-flex justify-content-center mt-2">
                                    <p>@ViewBag.Mensaje</p>
                                </div>
                            }
                        }
                    </article>
                </div>
            </div>
        </section>
    </form>

    <script src="../assets/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Obtener el elemento de entrada
        var amountInput = document.getElementById('amountInput');

        // Escuchar el evento de cambio en el campo de entrada
        amountInput.addEventListener('change', function () {
            // Obtener el valor actual y el valor máximo permitido
            var currentValue = parseInt(amountInput.value);
            var maxValue = parseInt(amountInput.max);

            // Si el valor actual es mayor que el máximo permitido, establecer el valor máximo como el valor actual
            if (currentValue > maxValue) {
                amountInput.value = maxValue;
            }
        });
    </script>
</body>
